<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>mytest</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <!-- <script src="../lib/jquery-1.12.4-min.js"></script> -->
    
    <style>
        #canvas {
            width: 100%;
            height: 100%;
            background-image: url('../src/colorful-sky.jpg');
            background-size: 100%;
            z-index: -2;
            position: absolute;
            left: 0;
            top: 0;
        }
        h2 {
            position: absolute;
            top: 50px;
            left: 50%;
            margin-left: -140px;
            font-size: 50px;
            color: aliceblue;
            text-align: center;
            letter-spacing: 20px; /* 文字间隔 */
        }

    </style>
</head>
    <body>
        <canvas id="canvas" width="1200" height="500"></canvas>
        <h2>粒子特效</h2>
        <script>
            let canvas = document.querySelector('#canvas');
            let cxt = canvas.getContext('2d');
            let setArr = [];
            let maxNum = 30;
            // 绘制生成多个圆
            ballSet();
            function ballSet () {
                let timer1 = setInterval(() => {
                    // 控制小球总数
                    if (setArr.length >= maxNum) {
                        clearInterval(timer1);
                    }
                    let cX = 200 + Math.ceil(Math.random() * 200); // 200--400  Math.ceil对浮点数向上取整
                    let cY = 200 + Math.ceil(Math.random() * 200); // 初始Y坐标
                    let r = 5 + Math.ceil(Math.random() * 5); // 半径5-12
                    let red = Math.floor(Math.random() * 256); // 0--255
                    let green = Math.floor(Math.random() * 256); // rgba
                    let blue = Math.floor(Math.random() * 256);
                    let alpha = 0.5 + Math.random() * 0.3; // 0.5--0.8 透明度
                    let sX = -1 + Math.ceil(Math.random() * 6); // -1 --- 5  x轴速度
                    let sY = -1 + Math.ceil(Math.random() * 6);
                    let obj = {
                        cX: cX,
                        cY: cY,
                        r: r,
                        red: red,
                        green: green,
                        blue: blue,
                        alpha: alpha,
                        sX: sX,
                        sY: sY,
                        bgColor: `rgba(${red},${green},${blue},${alpha})`,
                    };
                    if (obj.sX !== 0 || obj.sY !== 0){ // 防止速度为0 ，不要静止的小球
                        setArr.push(obj);
                    }
                }, 1000/20);  // 每秒20
            }
            // 绘制圆的运动 
            ballDraw(setArr);
            function ballDraw (arr) {
                setInterval(() => {
                    // 绘制前要清空前一帧的画布
                    cxt.clearRect(0, 0, canvas.width, canvas.height)
                    arr.forEach(item => {
                        /* 边界碰撞处理 - 速度取反 */
                        if ((item.cX + item.r >= canvas.width) || (item.cX - item.r <= 0)) { // 碰到左右边界，反向弹
                            item.sX *= -1
                        }
                        if ((item.cY + item.r >= canvas.height) || (item.cY - item.r <= 0)) { // 碰到上下边界，反向弹
                            item.sY  *= -1
                        }
                        item.cX += item.sX;
                        item.cY += item.sY;
                        /* 绘制一个圆形 */
                        cxt.beginPath();
                        cxt.fillStyle = item.bgColor;
                        cxt.arc(item.cX, item.cY, item.r, 0, 2*Math.PI);
                        cxt.fill();
                    })
                }, 1000/60); // 每秒60
            }
        </script>
    </body>
</html>